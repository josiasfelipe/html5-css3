$(vgl.lib().vPlayer).run(function(){this.core={Init:function(e){this.initCurrentPlaylist=function(){this.setEvents();var t=e.defaults.currentPlaylist;"object"==typeof t&&t.length&&(this.loadService(),e.defaults.initWithTrackEvent)},this.loadService=function(){var t=e.defaults.currentSong;if(e.modules.getService(t),e.modules.isValidSong())if(e.modules.isValidSource()){e.front.controls.resetValuesPlayer();var r=e.modules.getFormatService(t);vgl.js("/js/lib/vPlayer"+(r.charAt(0).toUpperCase()+r.substr(1))+".js").then(this.initService)}else this.initWorker({message:"getValidSource",service:e.modules.getCurrentService(),data:e.modules.getObjSong()})},this.loadAndPlay=function(){var t=e.target.find(".vSearch"),r=e.target.find(".vOtherSubtitles");e.front.feedbackPlayer.hidePlayer(),e.front.controls.updateIconPlaylist(),e.core.loadService(),e.front.changeListItem(e.modules.getObjSong(),t),e.front.changeListItem(e.modules.getObjSong(),r)},this.setProgressbar=function(t){var r=e.modules.getFormatService(e.defaults.currentSong),o=e[r].getDuration();e[r].setProgressbar(t*o)},this.setTextSubtitle=function(t){e.front.controlsSub.setText(t)},this.initService=function(){var t=e.modules.getCurrentFormatService();if(e[t]&&!e[t].Init)e[t].loadPlayer(e);else{var r=vgl.lib().vPlayer;e[t]=new r[t].Init(e)}e.front.confSubtitle("hide"),e.front.feedbackPlayer.showPlayer(),e.front.controls.updateIconChangeAudio(),e.front.controls.firstSearch("remove"),e.front.controls.setTitleTime(),$("#"+e.id).trigger("changeMusicThenDoSearch.front"),e.front.controlsSub.disableConf(),e.front.feedbackPlayer.updateTitleMusic(),e.front.controlsSub.notifyVideo(),e.front.resetNotifyVideo(),(new e.modules.objValidSourceAndCount).count&&"youtube"!=e.modules.getCurrentService()||e.modules.resetControlsNotify()},this.updateSongsIfIsIndexedDB=function(t){var r=e.defaults.currentPlaylist,o=0,n=this;if(e.modules.getConfDefaultService(),e.defaults.indexedDB)for(var s=0,i=r.length;s<i;s++){var a=r[s];e.modules.getSourceIndexedDByPointer(a.pointerID,function(s){if(o++,s&&"object"==typeof s){var a=e.modules.getIndexByPointerIDFromPlaylist(s.pointerID,!0);if(a.length)for(var l=0,u=a.length;l<u;l++){var c=r[a[l]];null==!c.vglAudio&&(c.source=c.source&&s.service==c.service&&s.source!=c.source?s.source+","+c.source:s.source,c.service=s.service,s.ext&&(c.ext=s.ext))}}o==i&&t&&t(n)})}else t&&t(n)},this.verifyStatusPlaylist=function(t){var r=e.defaults.currentPlaylist,o=!1;if(r.length)for(var n=0,s=r.length;n<s;n++){var i=r[n];if(t)i.status=1,o=!0;else if(i.status){o=!0;break}}o||this.verifyStatusPlaylist(!0)},this.setVolume=function(t){t=t>=0&&t<=1?parseFloat(t).toFixed(2):1;var r=e.modules.getFormatService(e.defaults.currentSong);e[r].setVolume(t),e.modules.setVolumeByLocalStorage(t),e.front.controls.setVolume(100*t)},this.setDuration=function(){var t=this.getDuration();e.front.controls.setDuration(t)},this.getDuration=function(){var t=e.modules.getFormatService(e.defaults.currentSong);return e[t].getDuration()},this.getVolume=function(t){var r=e.modules.getFormatService(e.defaults.currentSong);e[r].getVolume(t)},this.isPlaying=function(){var t=e.modules.getFormatService(e.defaults.currentSong);return!!e[t]&&e[t].isPlaying()},this.play=function(){var t=e.modules.getFormatService(e.defaults.currentSong);e[t]&&e[t].play()},this.pause=function(){var t=e.modules.getFormatService(e.defaults.currentSong);e[t].pause()},this.stop=function(){var t=e.modules.getFormatService(e.defaults.currentSong);try{e[t].stop()}catch(e){}},this.next=function(t){e.core.stop();var r=e.modules.transition();if(e.modules.getFormatService(e.defaults.currentSong),!r.status){var o=!(!t||!t.force)&&t.force,n=e.modules.isNextOrPrev();e.modules.getNext({action:!0,force:o}),n.next=!0}e.front.updateContentPlayer(e.modules.getCurrentService()),e.defaults.currentPlaylist.length>1&&e.defaults.playlistOn&&e.modules.redirectLyric()},this.prev=function(t){e.core.stop();var r=e.modules.transition();if(e.modules.getFormatService(e.defaults.currentSong),!r.status){var o=!(!t||!t.force)&&t.force,n=e.modules.isNextOrPrev();e.modules.getPrev({action:!0,force:o}),n.next=!0}e.front.updateContentPlayer(e.modules.getCurrentService()),e.defaults.currentPlaylist.length>1&&e.defaults.playlistOn&&e.modules.redirectLyric()},this.confTimeUpdate=function(e,t){},this.updateAndPlay=function(t){if(!t||"object"!=typeof t)return!1;e.core.stop(),t.id?(e.modules.updateCurrentSongBySearch(t),this.loadAndPlay()):t.pointerID&&(e.modules.updateCurrentSongByPointerID(t.pointerID),this.loadAndPlay())},this.initWorker=function(r){!function(o){var n=new e.modules.Workermap;if(!n.worker){var s=vgl.lib().vPlayer;"function"==typeof Worker?n.worker=new Worker(e.modules.getURLForWorker(s.webworker.workerServices)):n.worker=new s.webworker.workerServices}n.worker&&t(n.worker,r)}()};var t=function(t,r){var o=function(t){switch(t.message){case"search":if("ok"==t.status)if(t.content.length){if(e.front.suggestedVideos&&"youtube"==t.service){var r={service:"youtube",id:e.front.suggestedVideos.join()},o=e.modules.getVideoInfoByID(r);if(o)for(suggestKey in o)-1==t.content.indexOf(suggestKey)&&t.content.unshift(o[suggestKey])}var n=e.modules.createObjSearch(t);e.front.render({action:"listSearch",data:n})}else e.front.render({action:"listSearch",data:{service:t.service}}),setTimeout(function(){e.front.errors.searchError(t)},300);else e.front.render({action:"listSearch",data:{service:t.service}}),setTimeout(function(){e.front.errors.searchError(t)},300);break;case"searchMore":n=e.modules.createObjSearch(t),e.front.render({action:"listSearch",data:n,searchMore:!0});break;case"getValidSource":if(t&&t.content&&t.content.length)(r=new e.modules.objValidSourceAndCount).arraySongs=t.content,r.service=t.service,r.pointerID=e.modules.getPointerIDByCurrentSong(),e.modules.getValidSource();else if(e.defaults.currentPlaylist.length==e.defaults.currentSong+1){var s="<p>Houve um problema ao tocar "+(e.defaults.currentPlaylist.length>1?" as m&uacute;sicas":"a m&uacute;sica")+".</p>";e.modules.notify({html:s,time:2500,force:!0}),setTimeout(function(){e.modules.updateCurrentSongBySearch({service:"youtube",url:"",userForce:!0}),e.front.controls.activeTab("youtube"),e.front.loading.stop(),e.core.loadAndPlay()},3e3)}else e.core.next();break;case"getSubtitle":e.subtitle.controlSubtitle(t.content)}};"function"==typeof Worker?(t.postMessage(r),t.onmessage=function(e){var t=e.data;o(t)}):(t.postMessageForceIn(r),$(t).off().on("onmessageWorker",function(e,t){o(t)}))};this.setEvents=function(){$("#"+e.id).on("canplay.core",function(t){e.defaults.autoPlay?e.play():(e.defaults.autoPlay=!0,$("#"+e.id).trigger("init.subtitle")),e.core.setVolume(e.modules.getVolumeByLocalStorage()),e.defaults.currentPlaylist.length>1&&e.defaults.playlistOn&&e.modules.redirectLyric()}).on("play.core",function(){e.front.controls.playing(!0),e.front.controls.setElemPlaying(),e.front.imgPlaylistActions.setPlaying(),e.front.source.playCurrentSong(),e.target.trigger("player.play")}).on("pause.core",function(){e.front.controls.playing(!1),e.front.imgPlaylistActions.setPause(),e.front.source.stopCurrentSong(),e.target.trigger("player.pause")}).on("timeupdate.core",function(t,r,o){e.front.controls.setProgressbar({time:r,duration:o}),e.front.controls.setCurrentTime(r),e.front.controls.setTitleTime(parseFloat(o)-r),e.core.confTimeUpdate(r,o),e.target.trigger("player.timeupdate",[r,o])}).on("buffering.core",function(t,r){e.front.controls.setBuffering(r)}).on("ended.core",function(){e.front.controls.setTitleTime(),e.core.next(),e.defaults.currentSong!=e.modules.getNextValid()&&e.front.loading.start(e.modules.getObjSong()),e.modules.resetControlsNotify(),e.target.trigger("player.ended")}).on("endedPlaylist.core",function(){1!=e.defaults.currentPlaylist.length||e.defaults.playlistOn||e.front.controls.setLabelEndedPlaylist(),e.target.trigger("player.endedPlaylist")}).on("playing.core",function(){$("#"+e.id).trigger("init.subtitle"),e.core.setDuration(),e.front.source.playCurrentSong(),e.front.loading.stop(),e.target.trigger("player.playing")}).on("doSearch.core",function(t,r){var o=r||e.modules.getObjSong();e.front.controls.firstSearch(function(){e.core.initWorker({message:"search",service:o.service,data:o})})}).on("doSimpleSearch.core",function(t,r){var o=r||e.modules.getObjSong();e.core.initWorker({message:"search",service:"all",data:o})})},e.defaults.indexedDB?this.updateSongsIfIsIndexedDB(function(t){e.front.render({action:"createPlayer"}),t.verifyStatusPlaylist(),t.initCurrentPlaylist()}):(e.front.render({action:"createPlayer"}),this.verifyStatusPlaylist(),this.initCurrentPlaylist())}}});