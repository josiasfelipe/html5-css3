$(vgl.lib().vPlayer).run(function(){this.subtitle={Init:function(t){var e;this.initSubtitle=function(){var i=t.modules.getObjSong(),s=t.modules.getDurationByCurrentSong(),o=this.initSubtitle._instance,n=new this.SubtitleArray;if(e=$("#"+t.id),o&&o.pointerID==i.pointerID&&o.duration&&n&&n.subtitle&&n.subtitle.length)this.controlSubtitle(n.subtitle);else if(i.subID&&i.langID||(n.subtitle=!1),!t.modules.isBrowserHidden())return i.duration=s,t.defaults.subtitle?this.getSubtitle(i):this.controlSubtitle(),this.initSubtitle._instance={pointerID:i.pointerID,duration:s},this},this.getSubtitle=function(e){var i=e.pointerID,s=e.duration,o=e.langID,n=e.subID,a=(e.service,e.source.split(",")[0]);if(e.videoArtist)return t.core.setTextSubtitle(""),t.front.controlsSub.disableConf(),!1;s||(s=t.modules.getDurationByCurrentSong());var u="https://app2.vagalume.com.br/ajax/subtitle-get.php?";u+=n?"action=getBestSubtitle&pointerID="+i+("youtube"==e.service?"&forceVideoID="+a:"")+"&forceSubtitleID="+n+"&otherLang=1":"action=getBestSubtitle&pointerID="+i+"&duration="+parseInt(s,10)+("youtube"==e.service?"&videoID="+a:"")+(o?"&langID="+o:""),t.core.initWorker({message:"getSubtitle",url:u+"&nc=20171228"})},this.searchMoreLang=function(e){if(!e||"object"!=typeof e||!Object.keys(e).length)return!1;var i="https://app2.vagalume.com.br/ajax/subtitle-get.php?action=getSubtitlesForLang&pointerID="+(!!e.pointerID&&e.pointerID)+"&duration="+(!!e.duration&&e.duration)+"&langID="+(!!e.langID&&e.langID)+"&listLangs=1";$.getJSON(i,function(e){t.front.insertListOtherSub(e)})},this.controlSubtitle=function(i){var s=new this.SubtitleArray;s.subtitle&&i[0]&&(s.subtitle.subtitles=i,i=s.subtitle),t.defaults.subtitle?i&&(i.captcha||i.serial)?(s.subtitle=!1,t.core.setTextSubtitle('Detectamos muitos acessos.<span class=activeWithCaptcha data-serial="'+i.serial+'">Reativar legenda &raquo;</span>'),t.front.controlsSub.disableConf()):i&&i.subtitles?(t.modules.getObjByLangID(i.langs,i.subtitles[0].lID)||(i.subtitles[0].lID=i.langs[0].langID),e.hasClass("mobile")&&this.removeMobileSubtitleAnimation(),s.subtitle=i,t.core.setTextSubtitle("...")):i&&"couldNotGetSubtitle"===i[1]&&(s.subtitle=!1,t.core.setTextSubtitle('Seja o primeiro a criar legenda para esta m&uacute;sica!<p class="newSub vico" title="Criar esta legenda agora!" data-icon=+>Criar legenda &raquo;</p>'),t.front.controlsSub.setNameUser(""),t.front.controlsSub.disableConf()):(i=!1,t.core.setTextSubtitle('<span style="font-size:13px">Ouça esta música com legenda!<br><b class="activeSub vico" title="Ativar legenda"><a  href="javascript:void(0)">Clique aqui para ativar &raquo;</a></b><span>'),t.front.controlsSub.disableConf(),t.front.controlsSub.setNameUser(""),e.hasClass("mobile")&&this.removeMobileSubtitleAnimation()),this.setInfoSubtitle(i)},this.setMobileSubtitleAnimation=function(){e.hasClass("no-subtitle")||e.hasClass("subtitle-transition")||(e.addClass("subtitle-transition"),setTimeout(function(){e.addClass("no-subtitle"),setTimeout(function(){e.removeClass("subtitle-transition")},350)},50))},this.removeMobileSubtitleAnimation=function(){e.hasClass("no-subtitle")&&!e.hasClass("subtitle-transition")&&(e.addClass("subtitle-transition"),setTimeout(function(){e.removeClass("no-subtitle"),setTimeout(function(){e.removeClass("subtitle-transition")},350)},50))},this.reportSubtitle=function(e){var i=$(e),s=t.subtitle.SubtitleArray(),o=s.subtitle.subtitles[0].pID,n=s.subtitle.subtitles[0].sID;i.hasClass("reported")?alert("Sua den&uacute;ncia j&aacute; foi enviada para nossa equipe. Obrigado!"):confirm("Deseja denunciar esta legenda?")&&$.getJSON(location.protocol+"//app2.vagalume.com.br/ajax/subtitle-post.php",{action:"denunciaSubtitle",pointerID:o,subtitleID:n},function(t){t[0]?(i.addClass("reported"),alert("Denúncia enviada!")):"alreadyVote"==t[1]?alert("Esta legenda acabou de ser denunciada"):"noVote"==t[1]&&alert("Erro ao denunciar, tente novamente.")})},this.setInfoSubtitle=function(e){if(e&&"object"==typeof e&&e.subtitles&&e.subtitles.length){t.front.controlsSub.setLang(e),t.front.controlsSub.setNameUser(e),t.front.controlsSub.enableConf();var i=e.subtitles[0].offset;i?t.front.controlsSub.setOffset(i):t.front.controlsSub.resetOffset(i);var s=t.modules.getObjSong(),o=e.subtitles[0].yt_vinc;if(o&&o!=s.source){var n={};n[t.modules.MD5(o)]={service:"youtube",url:o},(new t.modules.objSearch).add(n),t.front.controlsSub.notifyVideo(!0,o)}}},this.timeSubtitle=function(e){var i=(new this.SubtitleArray).subtitle,n=t.modules.getObjSong();if(i&&i.subtitles&&i.subtitles[0].pID==n.pointerID){if(e.textCompressed=i.subtitles[0].text_compressed,e.offset=parseFloat(t.front.controlsSub.getOffset()),isNaN(e.offset))return;var a=s(e),u=e.time/e.duration*100;u&&Math.round(u)>=75&&Math.round(u)<=90&&(i.subtitles[0].offset=i.subtitles[0].offset?parseFloat(i.subtitles[0].offset):0,e.offset!=i.subtitles[0].offset&&null===setTimeOutsubtitleSyncTime&&(setTimeOutsubtitleSyncTime=setTimeout(function(){var s;clearTimeout(setTimeOutsubtitleSyncTime),setTimeOutsubtitleSyncTime=null,s={duration:e.duration,offset:e.offset,id:i.subtitles[0].sID,pointerID:i.subtitles[0].pID,service:t.modules.getObjSong().service},i.subtitles[0].offset=e.offset,o(s)},5e3))),t.core.setTextSubtitle(a)}};var i,s=function(t){var e=t.time,i=(t.duration,t.textCompressed),s="...",o=0;e+=parseInt(t.offset);for(var n=i.length;o<n;o++)if(e>=i[o][1]&&e<i[o][2]){s=i[o][0];break}return null==i[o]?s:[s,i[o][1],i[o][2],t.time]},o=function(e){if(t.modules.getCookie("sessionID")){serviceName=e.service;var i={action:"addSubtitleOffset",pointerID:e.pointerID,subtitleID:e.id,duration:e.duration,offset:e.offset,service:serviceName,sessionID:t.modules.getCookie("sessionID"),sessionUser:t.modules.getCookie("sessionUser")};$.ajax({url:location.protocol+"//app2.vagalume.com.br/ajax/subtitle-post.php",type:"POST",dataType:"json",data:i})}};this.SubtitleArray=(SubtitleArray=function(){if(i)return i;i=this,this.subtitle=!1},SubtitleArray),this.setEvents=function(){$("#"+t.id).on("init.subtitle",function(){t.subtitle.initSubtitle()}),t.target.off("player.timeupdate").on("player.timeupdate",function(e,i,s){t.subtitle.timeSubtitle({duration:s,time:i})})}}}});